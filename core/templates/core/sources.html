{% extends 'base.html' %}
{% load i18n static %}

{% block title %}{% trans "Wissenschaftliche Quellen" %} – HomeGym{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">

  <!-- Header -->
  <div class="row mb-4">
    <div class="col">
      <h1 class="h3 fw-bold">
        <i class="bi bi-journal-bookmark text-primary me-2"></i>
        {% trans "Wissenschaftliche Quellen" %}
      </h1>
      <p class="text-muted">
        {% trans "Die Algorithmen und Empfehlungen in HomeGym basieren auf peer-reviewter Forschungsliteratur. Hier findest du alle verwendeten Quellen." %}
        <strong>{% blocktrans with n=gesamt_count %}{{ n }} Quellen{% endblocktrans %}</strong> {% trans "insgesamt." %}
      </p>
    </div>
  </div>

  <!-- Kategorie-Tabs -->
  <div class="mb-4">
    <div class="d-flex flex-wrap gap-2">
      <a href="{% url 'sources_list' %}"
         class="btn btn-sm {% if not selected_category %}btn-primary{% else %}btn-outline-secondary{% endif %}">
        <i class="bi bi-grid me-1"></i>{% blocktrans with n=gesamt_count %}Alle ({{ n }}){% endblocktrans %}
      </a>
      {% for kat in kategorien %}
      <a href="{% url 'sources_list' %}?category={{ kat.key }}"
         class="btn btn-sm {% if kat.active %}btn-primary{% else %}btn-outline-secondary{% endif %}">
        {{ kat.label }} ({{ kat.count }})
      </a>
      {% endfor %}
    </div>
  </div>

  <!-- Quellen-Liste -->
  {% if quellen %}
    <div class="row g-3">
      {% for quelle in quellen %}
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
              <div class="flex-grow-1">

                <!-- Titel + Badge -->
                <div class="d-flex align-items-start gap-2 mb-1">
                  <span class="badge bg-secondary text-uppercase" style="font-size:0.65rem; white-space:nowrap;">
                    {{ quelle.get_category_display }}
                  </span>
                  <h5 class="card-title mb-0 fw-semibold" style="font-size: 1rem; line-height: 1.4;">
                    {{ quelle.title }}
                  </h5>
                </div>

                <!-- Autoren + Jahr + Journal -->
                <p class="text-muted mb-2" style="font-size: 0.875rem;">
                  <strong>{{ quelle.authors }}</strong>
                  ({{ quelle.year }})
                  {% if quelle.journal %}
                    — <em>{{ quelle.journal }}</em>
                  {% endif %}
                </p>

                <!-- Key Findings -->
                {% if quelle.key_findings %}
                <ul class="mb-2 ps-3" style="font-size: 0.875rem;">
                  {% for finding in quelle.key_findings %}
                  <li class="mb-1">{{ finding }}</li>
                  {% endfor %}
                </ul>
                {% endif %}

                <!-- Applies-to-Chips -->
                {% if quelle.applies_to %}
                <div class="d-flex flex-wrap gap-1">
                  {% for tag in quelle.applies_to %}
                  <span class="badge bg-light text-secondary border" style="font-size: 0.7rem;">
                    {{ tag }}
                  </span>
                  {% endfor %}
                </div>
                {% endif %}

              </div>

              <!-- DOI / URL Button -->
              <div class="ms-2 flex-shrink-0">
                {% if quelle.doi %}
                <a href="https://doi.org/{{ quelle.doi }}"
                   target="_blank" rel="noopener noreferrer"
                   class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-box-arrow-up-right me-1"></i>DOI
                </a>
                {% elif quelle.url %}
                <a href="{{ quelle.url }}"
                   target="_blank" rel="noopener noreferrer"
                   class="btn btn-sm btn-outline-secondary">
                  <i class="bi bi-link-45deg me-1"></i>{% trans "Link" %}
                </a>
                {% else %}
                <span class="text-muted" style="font-size:0.8rem;">{% trans "Kein Link" %}</span>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

  {% else %}
    <div class="text-center py-5 text-muted">
      <i class="bi bi-search display-4 d-block mb-3"></i>
      {% trans "Keine Quellen in dieser Kategorie gefunden." %}
      <a href="{% url 'sources_list' %}">{% trans "Alle Quellen anzeigen" %}</a>
    </div>
  {% endif %}

  <!-- Hinweis -->
  <div class="alert alert-info mt-5" role="alert">
    <i class="bi bi-info-circle me-2"></i>
    <strong>{% trans "Hinweis:" %}</strong>
    {% trans "Die ℹ-Icons in der App verweisen auf diese Seite. Wissenschaftliche Empfehlungen sind Richtwerte – individuelle Faktoren (Genetik, Erholung, Ernährung) beeinflussen das Ergebnis. Diese App ersetzt keine professionelle Trainingsberatung." %}
  </div>

</div>
{% endblock %}
